<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Miseda Inspect SRL</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: #f8f9fc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 70px; /* Space for fixed navbar */
        }
        
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .page-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content-wrapper {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
            margin-bottom: 2rem;
        }
        
        .btn {
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Footer */
        .footer {
            background: #f8f9fc;
            border-top: 1px solid #e3e6f0;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        
        /* Navigation breadcrumb styling */
        .breadcrumb {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
        }
        
        .breadcrumb-item a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
        }
        
        .breadcrumb-item a:hover {
            color: white;
        }
        
        .breadcrumb-item.active {
            color: rgba(255,255,255,0.9);
        }
    </style>
</head>
<body>
    @await Html.PartialAsync("_MainNavigation")
    
    @if (ViewData["ShowPageHeader"]?.ToString() != "false")
    {
        <div class="page-header">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h1 class="page-title">@ViewData["Title"]</h1>
                        @if (!string.IsNullOrEmpty(ViewData["Subtitle"]?.ToString()))
                        {
                            <p class="page-subtitle">@ViewData["Subtitle"]</p>
                        }
                        
                        <!-- Dynamic Breadcrumbs -->
                        <nav aria-label="breadcrumb" class="mt-3" id="pageBreadcrumb">
                            <ol class="breadcrumb mb-0" id="pageBreadcrumbList">
                                <!-- Breadcrumbs will be populated by JavaScript -->
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    }
    
    <div class="container">
        <main role="main">
            @RenderBody()
        </main>
    </div>
    
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <small class="text-muted">
                        &copy; @DateTime.Now.Year - Miseda Inspect SRL. Toate drepturile rezervate.
                    </small>
                </div>
                <div class="col-md-6 text-end">
                    <small>
                        <a href="@Url.Action("NavigationTest", "Test")" class="text-muted">
                            <i class="fas fa-vial"></i> Test Navigare
                        </a>
                    </small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to top button -->
    <button type="button" class="btn btn-primary position-fixed bottom-0 end-0 m-3" id="backToTop" style="display: none;" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Generate page breadcrumbs
            generatePageBreadcrumbs();
            
            // Back to top functionality
            setupBackToTop();
            
            // Page loading analytics
            logPageLoad();
        });
        
        function generatePageBreadcrumbs() {
            const path = window.location.pathname;
            const pathSegments = path.split('/').filter(segment => segment);
            const breadcrumbList = document.getElementById('pageBreadcrumbList');
            
            if (!breadcrumbList || pathSegments.length === 0) return;
            
            // Clear existing breadcrumbs
            breadcrumbList.innerHTML = '';
            
            // Add home
            const homeItem = document.createElement('li');
            homeItem.className = 'breadcrumb-item';
            homeItem.innerHTML = '<a href="/"><i class="fas fa-home"></i> Acas?</a>';
            breadcrumbList.appendChild(homeItem);
            
            // Add path segments
            let currentPath = '';
            pathSegments.forEach((segment, index) => {
                currentPath += '/' + segment;
                const item = document.createElement('li');
                item.className = 'breadcrumb-item';
                
                const displayName = getBreadcrumbDisplayName(segment);
                
                if (index === pathSegments.length - 1) {
                    item.className += ' active';
                    item.setAttribute('aria-current', 'page');
                    item.textContent = displayName;
                } else {
                    item.innerHTML = `<a href="${currentPath}">${displayName}</a>`;
                }
                
                breadcrumbList.appendChild(item);
            });
        }
        
        function getBreadcrumbDisplayName(segment) {
            const displayNames = {
                'clients': 'Clien?i',
                'appointments': 'Program?ri',
                'notifications': 'Notific?ri',
                'admin': 'Administrare',
                'account': 'Cont',
                'test': 'Teste',
                'create': 'Adaug?',
                'edit': 'Editare',
                'details': 'Detalii',
                'dashboard': 'Dashboard',
                'calendar': 'Calendar',
                'users': 'Utilizatori',
                'systeminfo': 'Info Sistem',
                'navigationtest': 'Test Navigare',
                'testemail': 'Test Email',
                'testsms': 'Test SMS'
            };
            
            return displayNames[segment.toLowerCase()] || 
                   segment.charAt(0).toUpperCase() + segment.slice(1);
        }
        
        function setupBackToTop() {
            const backToTopBtn = document.getElementById('backToTop');
            
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopBtn.style.display = 'block';
                } else {
                    backToTopBtn.style.display = 'none';
                }
            });
        }
        
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        function logPageLoad() {
            const loadTime = performance.now();
            console.log(`Pagina ${window.location.pathname} înc?rcat? în ${Math.round(loadTime)}ms`);
            
            // Track page type for analytics
            const path = window.location.pathname.toLowerCase();
            let pageType = 'other';
            if (path.includes('/clients')) pageType = 'clients';
            else if (path.includes('/appointments')) pageType = 'appointments';
            else if (path.includes('/notifications')) pageType = 'notifications';
            else if (path.includes('/admin')) pageType = 'admin';
            else if (path.includes('/test')) pageType = 'test';
            else if (path === '/') pageType = 'home';
            
            console.log(`Page type: ${pageType}`);
        }
        
        // Enhanced keyboard shortcuts for this layout
        document.addEventListener('keydown', function(e) {
            if (e.altKey) {
                let handled = false;
                switch(e.key) {
                    case 'ArrowUp':
                        scrollToTop();
                        handled = true;
                        break;
                    case 'ArrowDown':
                        window.scrollTo({
                            top: document.body.scrollHeight,
                            behavior: 'smooth'
                        });
                        handled = true;
                        break;
                }
                
                if (handled) {
                    e.preventDefault();
                }
            }
        });
    </script>
    
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>